# üìä Donation Website - Backend

Backend donation application with Midtrans sandbox payment gateway integration. This project is the backend part of a donation application, with the frontend available at the following repository:

‚û°Ô∏è **Frontend repository:** [https://github.com/AdnSmile/donation-fe](https://github.com/AdnSmile/donation-fe)

---

## ‚ú® Project Overview
This application allows users to make donations via bank transfer (BCA, BRI, BNI) using a virtual account (VA) automatically generated by Midtrans.

> **Note:** All bank payments in this project use the Midtrans sandbox environment. No real money is transferred. All transactions are for testing and development purposes only.

After a donation is created, the user will receive an email with payment details. Payment status is automatically updated via notifications from Midtrans.

---

## üèóÔ∏è Architecture Overview
- **Spring Boot (Kotlin):** Backend REST API
- **PostgreSQL:** Donation database
- **Midtrans:** Payment gateway (bank transfer VA)
- **Email SMTP:** Email notifications to donors
- **Main flow:**
  - User fills out the donation form on the frontend
  - Frontend sends a request to the backend endpoint `/api/donate`
  - Backend creates a transaction with Midtrans, saves the donation data (pending status), and sends an email to the donor
  - Midtrans sends a payment notification to the endpoint `/api/payment/notification`
  - Backend updates the donation status and sends a confirmation email to the donor

---

## üöÄ Setup & Running the Application

### Prerequisites
- Java 17+
- Maven
- PostgreSQL

### 1. Clone the repository
```bash
git clone https://github.com/AdnSmile/donation-be
cd donation-be
```

### 2. Configure Environment Variables
Copy and adjust the `application.properties` file (or use environment variables as needed):

```properties
spring.datasource.url=jdbc:postgresql://<DB_HOST>:<DB_PORT>/<DB_NAME>
spring.datasource.username=<DB_USER>
spring.datasource.password=<DB_PASS>
# ...
SERVER_KEY=<MIDTRANS_SERVER_KEY>
MIDTRANS_URL=<MIDTRANS_API_URL>
spring.mail.username=<EMAIL_USER>
spring.mail.password=<EMAIL_PASS>
```
> **Note:** Never commit actual credential values to a public repository.

### 3. Run the Application
```bash
./mvnw spring-boot:run
```
The application will run at `http://localhost:8080`

---

## üìö Main Endpoints

### 1. Create Donation
- **Endpoint:** `POST /api/donate`
- **Request Body:**
```json
{
  "amount": 5000,
  "name": "John Doe",
  "email": "john@example.com",
  "note": "Optional message",
  "bank": "bri"
}
```
- **Example Success Response:**
```json
{
  "status": "Success",
  "message": "Donation transaction created successfully",
  "data": {
    "bank": "BRI",
    "amount": "5000",
    "vaNumber": "688849549496135115",
    "linkPayment": "https://simulator.sandbox.midtrans.com/bri/va/index"
  }
}
```

### 2. Payment Notification (From Midtrans)
- **Endpoint:** `POST /api/payment/notification`
- **Request Body:** (Example payload from Midtrans, partial fields)
```json
{
  "va_numbers": [
    { "bank": "bri", "va_number": "688849549496135115" }
  ],
  "transaction_time": "2024-06-01 12:00:00",
  "transaction_status": "settlement",
  "transaction_id": "1234567890",
  "order_id": "Donation-<UUID>",
  "status_message": "midtrans payment notification",
  "status_code": "200",
  "signature_key": "...",
  "payment_type": "bank_transfer",
  "merchant_id": "...",
  "gross_amount": "5000",
  "fraud_status": "accept",
  "expiry_time": "2024-06-02 12:00:00",
  "currency": "IDR"
}
```
- **Example Success Response:**
```json
"Notification processed successfully"
```
- **Example Failure Response:**
```json
"Donation not found"
```

---

## ‚öôÔ∏è Technologies Used
- Kotlin, Spring Boot, Maven
- PostgreSQL
- Midtrans API
- SMTP (Gmail) for email notifications

---

## üîó Frontend
The frontend for this donation application can be found at:
[https://github.com/AdnSmile/donation-fe](https://github.com/AdnSmile/donation-fe)

---

If you have any questions or need further assistance, please contact the project maintainer.
